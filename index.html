<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>患者入室（Patient Entry）音声ガイド</title>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Segoe UI",sans-serif;
background:linear-gradient(180deg,#f7fbff,#eef6ff);color:#0f172a;}
.header{padding:18px 16px 10px;}
.frame-title{border:2px solid #38bdf8;padding:14px 16px;border-radius:14px;background:#f8fcff;text-align:center;}
.frame-title h1{margin:0;font-size:20px;}
.frame-title p{margin:6px 0 0;font-size:14px;color:#475569;}
.note{font-size:12px;color:#475569;margin:12px 16px;}
.main{margin:0 16px 24px;padding:16px;background:#fff;border-radius:18px;box-shadow:0 8px 18px rgba(15,23,42,.08);}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
select{flex:1;max-width:100%;font-size:16px;padding:10px 36px 10px 12px;border-radius:12px;border:1px solid #cbd5f5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
button{font-size:15px;padding:10px 14px;border-radius:12px;border:1px solid #cbd5f5;background:#eff6ff;}
button:active{transform:scale(.98);}
.label{margin-top:14px;font-size:13px;color:#475569;}
.jp{font-size:18px;font-weight:600;margin-top:6px;}
.en{font-size:16px;margin-top:4px;}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;}
audio{width:100%;margin-top:10px;}
.status{margin-top:8px;font-size:13px;color:#475569;}
.hint{margin-top:10px;font-size:12px;color:#64748b;}



/* === Pain / Extravasation Modal (emergency-style sheet) === */
.fab-pain{position:fixed;left:16px;bottom:16px;z-index:10000;
background:#f8fcff;border:2px solid #38bdf8;color:#0f172a;
border-radius:14px;padding:12px 14px;font-weight:800}
.pain-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);
z-index:9998;display:none}
.pain-sheet{position:fixed;left:0;right:0;bottom:0;z-index:9999;
display:none;padding:12px 12px 18px}
.pain-panel{max-width:860px;margin:0 auto;background:#fff;
border-radius:20px;padding:12px 12px 14px;box-shadow:0 18px 40px rgba(15,23,42,.25)}
.pain-list{display:flex;flex-direction:column;gap:10px;max-height:52vh;overflow:auto;padding:4px}
.pain-item{border:1px solid #e2e8f0;border-radius:16px;padding:12px 12px;background:#ffffff}
.pain-item:active{transform:scale(.99)}
.pain-item.is-active{border-color:#38bdf8;box-shadow:0 0 0 3px rgba(56,189,248,.18)}
.pain-jp{font-weight:800;font-size:16px;line-height:1.25}
.pain-en{font-size:13px;color:#475569;margin-top:4px;line-height:1.25}
.pain-audio{margin-top:12px}
.pain-footer{display:flex;justify-content:space-between;gap:10px;align-items:center;margin-top:10px}
.pain-close{background:#eff6ff;border:1px solid #cbd5f5;border-radius:14px;padding:10px 14px;font-size:15px}
.pain-title{font-size:12px;color:#64748b;margin:0 0 8px 6px}
.pain-badge{display:inline-block;margin-right:8px;padding:2px 8px;border-radius:999px;
font-size:12px;font-weight:800;border:1px solid #cbd5f5;background:#eff6ff;color:#0f172a}
.pain-badge.alert{border-color:#fecaca;background:#fff1f2;color:#9f1239}
.pain-badge.check{border-color:#fde68a;background:#fffbeb;color:#92400e}
.pain-badge.ok{border-color:#bbf7d0;background:#f0fdf4;color:#166534}

</style>
</head>
<body>
<div class="header">
  <div class="frame-title">
    <h1>患者入室（Patient Entry）</h1>
    <p>English Audio Guide</p>
  </div>
</div>

<p class="note">※ iPhone / iPad / Android で再生できます。最初は「再生」を押してください。</p>

<div class="main">
  <div class="row">
    <select id="sel"></select>
    <button id="prev">← 前</button>
    <button id="next">次 →</button>
  </div>

  <div class="label">日本語（内容）</div>
  <div class="jp" id="jp"></div>

  <div class="label">English (Script)</div>
  <div class="en" id="en"></div>

  <div class="controls">
    <button id="play">▶︎ 再生</button>
    <button id="pause">⏸ 一時停止</button>
    <button id="replay">↻ もう一度</button>
  </div>

  <div class="status" id="status">待機中 / Ready</div>
  <audio id="player" controls></audio>

  <div class="hint">
    再生できない場合：消音モード解除、音量、Bluetooth接続を確認してください。
  </div>
</div>

<script>
const STEPS = [
 {preview:"本日の通訳はすでに退勤しています…", jp:"本日の通訳はすでに退勤していますので、英語のガイドを使って説明します。", en:"Our interpreter has already left for the day, so I'll explain using an English guide."},
 {preview:"分からないことがあれば…", jp:"分からないことがあれば、いつでも言ってください。", en:"Please let me know if anything is unclear."},
 {preview:"生年月日を教えてください…", jp:"生年月日を教えていただけますか？", en:"Could you tell me your date of birth?"},
 {preview:"心臓デバイスの確認…", jp:"胸にペースメーカー、ICD、CRTなどの心臓デバイスは入っていますか？", en:"Do you have any heart devices in your chest, like a pacemaker, ICD, or CRT?"},
 {preview:"ベッドに座ってください…", jp:"ベッドに座って、靴を脱いでください。", en:"Please sit on the bed and take off your shoes."},
 {preview:"仰向けに寝てください…", jp:"ベッドに仰向けで寝てください。", en:"Please lie on your back on the bed."},
 {preview:"頭と足の位置…", jp:"頭はここ、足はあちらです。", en:"Your head goes here, and your feet go there."},
 {preview:"立ち上がって座る…", jp:"ゆっくり立ち上がって、ベッドに座ってください。", en:"Please stand up slowly and sit on the bed."},
 {preview:"スライドボード…", jp:"背中の後ろにスライドボードを入れますね。", en:"I'll put a slide board behind your back."},
 {preview:"ベッドへ移動…", jp:"これからベッドに移りますね。", en:"Let me slide you onto the bed now."},
 {preview:"少し上に…", jp:"少し上にずれてください。", en:"Please slide up a little."},
 {preview:"少し下に…", jp:"少し下にずれてください。", en:"Please slide down a little."},
 {preview:"上に移動…", jp:"少し上に移動しますね。", en:"I'll slide you up a little."},
 {preview:"下に移動…", jp:"少し下に移動しますね。", en:"I'll slide you down a little."},
 {preview:"首は大丈夫？", jp:"首はつらくないですか？", en:"Is your neck comfortable?"},
 {preview:"高さの確認…", jp:"高すぎたり低すぎたりしませんか？", en:"Is it not too high or low?"},
 {preview:"ベッドが動きます…", jp:"ベッドが動きますので、動かないでください。", en:"The bed will move now, so please stay still."}
];

const sel=document.getElementById('sel'),
jp=document.getElementById('jp'),
en=document.getElementById('en'),
player=document.getElementById('player'),
status=document.getElementById('status');

STEPS.forEach((s,i)=>{
 const o=document.createElement('option');
 o.value=i;
 o.textContent=`${String(i+1).padStart(2,'0')}｜${s.jp}`;
 sel.appendChild(o);
});

let idx=0;
function load(i){
 idx=Math.max(0,Math.min(STEPS.length-1,i));
 sel.value=idx;
 jp.textContent=STEPS[idx].jp;
 en.textContent=STEPS[idx].en;
 player.src=`audio/step_${String(idx+1).padStart(2,'0')}.m4a`;
 status.textContent="待機中 / Ready";
}
sel.onchange=()=>load(parseInt(sel.value));
document.getElementById('prev').onclick=()=>load(idx-1);
document.getElementById('next').onclick=()=>load(idx+1);
document.getElementById('play').onclick=()=>player.play();
document.getElementById('pause').onclick=()=>player.pause();
document.getElementById('replay').onclick=()=>{player.currentTime=0;player.play();}
player.onplay=()=>status.textContent="再生中 / Playing";
player.onpause=()=>status.textContent="一時停止 / Paused";
player.onended=()=>status.textContent="待機中 / Ready";


load(0);


/* === Pain / Extravasation sheet (tap-to-play) === */
document.addEventListener('DOMContentLoaded',()=>{
  const PAIN=[
    {tag:'alert', jp:'痛みを感じたとのことなので、テスト注入を一度中止します。', 
     en:"We’ll stop the test injection for now, because you felt some pain.",
     a:'audio/pain_01_stop.m4a'},
    {tag:'check', jp:'どのあたりが痛みますか？今、針を刺している場所ですか？',
     en:"Where does it hurt? Is it around the injection site?",
     a:'audio/pain_02_where.m4a'},
    {tag:'check', jp:'その痛みは、少し我慢できそうですか？',
     en:"Is the pain something you think you can tolerate?",
     a:'audio/pain_03_tolerate.m4a'},
    {tag:'check', jp:'血管の外に漏れていないかを確認しますので、少しの間、動かずにいてください。',
     en:"We’re going to check for any leakage from the vein, so please stay still for a moment.",
     a:'audio/pain_04_stay_still.m4a'},
    {tag:'ok', jp:'血管からの漏れは確認されなかったので、針は正しい位置に入っているようです。',
     en:"There’s no sign of leakage from the vein, so it looks like the needle is in the correct position.",
     a:'audio/pain_05_no_leak.m4a'},
    {tag:'ok', jp:'注入速度を少し落として検査を続けます。痛みは少し続くかもしれませんが、できる範囲で頑張って耐えていただけると助かります。もし痛みが強くなったら、すぐに教えてくださいね。',
     en:"We’ll continue the scan at a slower injection speed. You may feel some discomfort, but if you can tolerate it, we’d really appreciate your cooperation. Please let us know right away if the pain gets worse.",
     a:'audio/pain_06_continue_slow.m4a'},
    {tag:'alert', jp:'血管からの漏れがありました。この部位は造影剤の注入には使いませんので、別の場所に新たに点滴を取らせていただきますね。',
     en:"There was some leakage from the vein. So, we won’t use this site for the contrast dye injection. We’ll place a new IV line in a different spot.",
     a:'audio/pain_07_leak.m4a'}
  ];

  const open=document.getElementById('painOpen');
  const back=document.getElementById('painBackdrop');
  const sheet=document.getElementById('painSheet');
  const list=document.getElementById('painList');
  const player=document.getElementById('painPlayer');
  const close=document.getElementById('painClose');

  if(!open || !back || !sheet || !list || !player || !close) return;

  const show=()=>{back.style.display='block';sheet.style.display='block';open.style.display='none';};
  const hide=()=>{back.style.display='none';sheet.style.display='none';open.style.display='';};

  list.innerHTML='';

  PAIN.forEach((s,i)=>{
    const d=document.createElement('div');
    d.className='pain-item';
    const badgeClass = s.tag==='alert' ? 'alert' : (s.tag==='ok' ? 'ok' : 'check');
    const badgeText  = s.tag==='alert' ? '注意' : (s.tag==='ok' ? '継続' : '確認');
    d.innerHTML=`<div class="pain-jp"><span class="pain-badge ${badgeClass}">${badgeText}</span>${String(i+1).padStart(2,'0')}｜${s.jp}</div>
                 <div class="pain-en">${s.en}</div>`;
    d.addEventListener('click',()=>{
      list.querySelectorAll('.pain-item').forEach(x=>x.classList.remove('is-active'));
      d.classList.add('is-active');
      player.src=s.a;
      player.play();
    });
    list.appendChild(d);
  });

  open.addEventListener('click', show);
  close.addEventListener('click', hide);
  back.addEventListener('click', hide);

  document.addEventListener('keydown',(e)=>{
    if(e.key==='Escape') hide();
  });
});




</script>


<button class="fab-pain" id="painOpen">痛みがある場合</button>
<div class="pain-backdrop" id="painBackdrop"></div>
<div class="pain-sheet" id="painSheet" role="dialog" aria-modal="true" aria-label="pain extravasation">
  <div class="pain-panel">
    <div class="pain-title">痛みがある場合 / If you feel pain during the test injection</div>
    <div class="pain-list" id="painList"></div>

    <div class="pain-audio">
      <audio id="painPlayer" controls style="width:100%"></audio>
    </div>

    <div class="pain-footer">
      <button class="pain-close" id="painClose" type="button">閉じる</button>
      <div style="font-size:12px;color:#64748b;">カードをタップして再生 / Tap a card to play</div>
    </div>
  </div>
</div>


</body>
</html>
